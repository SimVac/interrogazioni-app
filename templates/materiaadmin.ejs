<!DOCTYPE html>
<html lang="en" data-theme="lofi">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://cdn.jsdelivr.net/npm/daisyui@4.4.19/dist/full.min.css" rel="stylesheet" type="text/css" />
  <script src="https://cdn.tailwindcss.com"></script>

  <title><%= materia.abbreviazione %></title>
</head>

<body>
  <div>
    <div class="bg-base-200" style="height: 5vh">
      <button onclick="history.back()" class="btn btn-ghost absolute top-2 left-2">
        <svg class="fill-blue-500" xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24">
          <path d="m313-440 224 224-57 56-320-320 320-320 57 56-224 224h487v80H313Z" />
        </svg>
      </button>
    </div>
    <div class="hero min-h-screen bg-base-200">
      <div class="hero-content text-center">
        <div class="max-w-md">
          <h1 class="text-3xl font-bold"><%= materia.nome %></h1>

          <br />

          <div class="overflow-x-auto">
            <table class="table">
              <!-- head -->
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Cognome</th>
                  <th>Interrogato</th>
                  <th>Offerto</th>
                </tr>
              </thead>
              <tbody>
                <% for (studente of ordine) {%>
                <% let studenteoff = studente.cognome + "offerto" %>
                <tr>
                  <th><%=studente.nome%></th>
                  <th><%=studente.cognome%></th>
                  <% if (!studente.interrogato) {%>
                  <th>
                    <input id=<%= studente.cognome %> type="checkbox" class="toggle toggle-primary" />
                  </th>
                  <% } else { %>
                  <th>
                    <input id=<%= studente.cognome %> type="checkbox" class="toggle toggle-primary" checked />
                  </th>
                  <% } %> <% if(!studente.offerto) {%> <th>
                    <input id=<%= studenteoff %> type="checkbox" class="toggle toggle-primary" />
                  </th>
                  <%} else {%>
                  <th>
                    <input id=<%= studenteoff %> type="checkbox" class="toggle toggle-primary" checked />
                  </th>
                  <%}%> </tr>
                    <% } %>
              </tbody>
            </table>
            <br />
            <div class="flex flex-row justify-around">
              <button class="btn primary-btn" onclick="UpdateStudents()">
                Edit
              </button>
              <button class="btn primary-btn" onclick="SortStudents()">
                Shuffle
              </button>
              <button class="btn primary-btn" onclick="ResetStudents()">
                Reset
              </button>

              <div class="flex items-center">
                <label class="swap">
                  <input type="checkbox" id="attivo" <% if (materia.attivo) { %> checked <% } %> />

                  <svg class="swap-on fill-current" xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24">
                    <path d="M480-320q75 0 127.5-52.5T660-500q0-75-52.5-127.5T480-680q-75 0-127.5 52.5T300-500q0 75 52.5 127.5T480-320Zm0-72q-45 0-76.5-31.5T372-500q0-45 31.5-76.5T480-608q45 0 76.5 31.5T588-500q0 45-31.5 76.5T480-392Zm0 192q-146 0-266-81.5T40-500q54-137 174-218.5T480-800q146 0 266 81.5T920-500q-54 137-174 218.5T480-200Zm0-300Zm0 220q113 0 207.5-59.5T832-500q-50-101-144.5-160.5T480-720q-113 0-207.5 59.5T128-500q50 101 144.5 160.5T480-280Z" />
                  </svg>

                  <!-- volume off icon -->
                  <svg class="swap-off fill-current" xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24">
                    <path d="m644-428-58-58q9-47-27-88t-93-32l-58-58q17-8 34.5-12t37.5-4q75 0 127.5 52.5T660-500q0 20-4 37.5T644-428Zm128 126-58-56q38-29 67.5-63.5T832-500q-50-101-143.5-160.5T480-720q-29 0-57 4t-55 12l-62-62q41-17 84-25.5t90-8.5q151 0 269 83.5T920-500q-23 59-60.5 109.5T772-302Zm20 246L624-222q-35 11-70.5 16.5T480-200q-151 0-269-83.5T40-500q21-53 53-98.5t73-81.5L56-792l56-56 736 736-56 56ZM222-624q-29 26-53 57t-41 67q50 101 143.5 160.5T480-280q20 0 39-2.5t39-5.5l-36-38q-11 3-21 4.5t-21 1.5q-75 0-127.5-52.5T300-500q0-11 1.5-21t4.5-21l-84-82Zm319 93Zm-151 75Z" />
                  </svg>
                </label>
              </div>
            </div>

            <script>
              function UpdateStudents() {
                let materia = <%-JSON.stringify(materia)%>;
                let ordine = <%-JSON.stringify(ordine)%>;

                //prendo i nuovi valori
                for (let studente of ordine) {
                  let studenteoff = studente.cognome + "offerto"
                  let checkboxint = document.getElementById(studente.cognome);
                  let checkboxintoff = document.getElementById(studenteoff);
                  studente.interrogato = checkboxint.checked;
                  studente.offerto = checkboxintoff.checked;
                }

                ordine = ordine.filter(a => a.offerto).concat(ordine.filter(a => !a.offerto))

                materia.attivo = document.getElementById("attivo").checked

                const dati = {
                  ordine: ordine,
                  materia: materia
                }
                //invio i dati cambiati
                var xhr = new XMLHttpRequest();
                xhr.open('POST', '<%=host%>/updatedata');
                xhr.setRequestHeader("Content-Type", "application/json");
                xhr.send(JSON.stringify(dati));


                alert("Dati inviati")

                location.reload();
              }

              function SortStudents() {
                let materia = <%-JSON.stringify(materia)%>;
                let ordine = <%-JSON.stringify(ordine)%>;

                shuffle(ordine)

                const dati = {
                  ordine: ordine,
                  materia: materia
                }

                //invio i dati cambiati
                var xhr = new XMLHttpRequest();
                xhr.open('POST', '<%=host%>/updatedata');
                xhr.setRequestHeader("Content-Type", "application/json");
                xhr.send(JSON.stringify(dati));


                alert("Dati inviati")

                location.reload();
              }

              function shuffle(array) {
                let currentIndex = array.length,
                  randomIndex;

                // While there remain elements to shuffle.
                while (currentIndex > 0) {

                  // Pick a remaining element.
                  randomIndex = Math.floor(Math.random() * currentIndex);
                  currentIndex--;

                  // And swap it with the current element.
                  [array[currentIndex], array[randomIndex]] = [
                    array[randomIndex], array[currentIndex]
                  ];
                }
                return array;
              }

              function ResetStudents() {
                let materia = <%-JSON.stringify(materia)%>;
                let ordine = <%-JSON.stringify(ordine)%>;

                ordine = ordine.sort((a, b) => {
                  return a.cognome.toLowerCase().localeCompare(b.cognome.toLowerCase());
                });


                //prendo i nuovi valori
                for (let studente of ordine) {
                  studente.interrogato = false;
                  studente.offerto = false;
                }

                const dati = {
                  ordine: ordine,
                  materia: materia
                }

                //invio i dati cambiati
                var xhr = new XMLHttpRequest();
                xhr.open('POST', '<%=host%>/updatedata');
                xhr.setRequestHeader("Content-Type", "application/json");
                xhr.send(JSON.stringify(dati));


                alert("Dati inviati")

                location.reload();
              }
            </script>
          </div>
          <br />
          <br />
          <br />
          <div class="btm-nav">
            <button class="text-info" onclick="location.href = '/'">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
              </svg>
            </button>
            <button class="text-info" onclick="location.href = '/admin'">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
              </svg>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</body>

</html>